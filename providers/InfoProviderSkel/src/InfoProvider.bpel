<?xml version="1.0" encoding="UTF-8"?>
<process
    name="InfoProvider"
    targetNamespace="http://modalis.polytech.unice.fr/jSeduite/providers/bpel/InfoProvider"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/providers/bpel/InfoProvider" xmlns:ns0="http://modalis.polytech.unice.fr/jSeduite/providers/wsdl/InfoProvider" xmlns:ns1="http://modalis.polytech.unice.fr/jSeduite/providers/schema/InfoProvider" xmlns:ns2="http://modalis.i3s.unice.fr/jSeduite/sources/schema/CommonSource">
    <import namespace="http://modalis.polytech.unice.fr/jSeduite/providers/wsdl/InfoProvider" location="InfoProvider.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/AccountManagerServiceWrapper" location="TechPartners/AccountManagerServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://accounts.technical.jSeduite.modalis.i3s.unice.fr/" location="TechPartners/AccountManagerService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://modalis.i3s.unice.fr/jSeduite/sources/schema/CommonSource" location="Sources/CommonSource.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
    <import namespace="http://modalis.i3s.unice.fr/jSeduite/sources/wsdl/CalendarToday" location="Sources/CalendarToday.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="account" xmlns:tns="http://enterprise.netbeans.org/bpel/AccountManagerServiceWrapper" partnerLinkType="tns:AccountManagerLinkType" partnerRole="accounts"/>
        <partnerLink name="PartnerLink1" xmlns:tns="http://modalis.i3s.unice.fr/jSeduite/sources/wsdl/CalendarToday" partnerLinkType="tns:CalendarToday" partnerRole="CalendarTodayPortTypeRole"/>
        <partnerLink name="ext" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/providers/wsdl/InfoProvider" partnerLinkType="tns:InfoProvider" myRole="provider"/>
    </partnerLinks>
    <variables>
        <variable name="GetOut" xmlns:tns="http://modalis.i3s.unice.fr/jSeduite/sources/wsdl/CalendarToday" messageType="tns:GetResponse"/>
        <variable name="GetIn" xmlns:tns="http://modalis.i3s.unice.fr/jSeduite/sources/wsdl/CalendarToday" messageType="tns:GetRequest"/>
        <variable name="infos_set" type="ns2:InformationSet"/>
        <variable name="token" type="xsd:string"/>
        <variable name="password" type="xsd:string"/>
        <variable name="user" type="xsd:string"/>
        <variable name="IsAuthorizedOut" xmlns:tns="http://accounts.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:isAuthorizedResponse"/>
        <variable name="IsAuthorizedIn" xmlns:tns="http://accounts.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:isAuthorized"/>
        <variable name="GetAllInformationsOut" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/providers/wsdl/InfoProvider" messageType="tns:GetAllInformationsResponse"/>
        <variable name="GetAllInformationsIn" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/providers/wsdl/InfoProvider" messageType="tns:GetAllInformationsRequest"/>
    </variables>
    <sequence>
        <sequence name="a1">
            <receive name="a1_tech" createInstance="yes" partnerLink="ext" operation="GetAllInformations" portType="ns0:InfoProviderPortType" variable="GetAllInformationsIn"/>
            <assign name="a1_post">
                <copy>
                    <from>$GetAllInformationsIn.in/ns1:password</from>
                    <to variable="password"/>
                </copy>
                <copy>
                    <from>$GetAllInformationsIn.in/ns1:user</from>
                    <to variable="user"/>
                </copy>
            </assign>
        </sequence>
        <sequence name="a2">
            <assign name="a2_pre">
                <copy>
                    <from variable="password"/>
                    <to>$IsAuthorizedIn.parameters/password</to>
                </copy>
                <copy>
                    <from variable="user"/>
                    <to>$IsAuthorizedIn.parameters/login</to>
                </copy>
            </assign>
            <invoke name="a2_tech" partnerLink="account" operation="isAuthorized" xmlns:tns="http://accounts.technical.jSeduite.modalis.i3s.unice.fr/" portType="tns:AccountManager" inputVariable="IsAuthorizedIn" outputVariable="IsAuthorizedOut"/>
            <assign name="a2_post">
                <copy>
                    <from>string($IsAuthorizedOut.parameters/return)</from>
                    <to variable="token"/>
                </copy>
            </assign>
        </sequence>
        <flow name="sources">
            <sequence name="source">
                <assign name="s1"/>
                <invoke name="s2" partnerLink="PartnerLink1" operation="Get" xmlns:tns="http://modalis.i3s.unice.fr/jSeduite/sources/wsdl/CalendarToday" portType="tns:CalendarTodayPortType" inputVariable="GetIn" outputVariable="GetOut"/>
                <assign name="s3"/>
            </sequence>
        </flow>
        <sequence name="a4">
            <assign name="a4_pre">
                <copy>
                    <from variable="infos_set"/>
                    <to>$GetAllInformationsOut.out/ns1:result</to>
                </copy>
            </assign>
            <reply name="a4_tech" partnerLink="ext" operation="GetAllInformations" portType="ns0:InfoProviderPortType" variable="GetAllInformationsOut"/>
        </sequence>
    </sequence>
</process>
