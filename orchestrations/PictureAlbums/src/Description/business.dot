digraph feed_reader_business {

  label="PictureAlbums business process";
  fontname="Courier";
  node [fontsize=12, shape="record"];
  edge [fontname="Courier", fontsize=9];
  fontsize=12;

  a1 [label="a1|receive(maxSize)"];
  a2 [label="a2|descr* := PictureAlbumRegistry::getValidAlbums()"];
  a13 [label="a13|result.source := descr.source|<p>*",fillcolor="#FFFFCC",style=filled];
  a14 [label="a14|result.name := descr.name|<p>*",fillcolor="#FFFFCC",style=filled];
  t [label="t| c := isEqual(result.repository,'picasa')|<p>*",fillcolor="#FFFFCC",style=filled];
  a003 [label="a003|raw* := PicasaWrapper::getalbumContent(descr.user,descr.album)|<p>*",fillcolor="#FFFFCC",style=filled];
  a013 [label="a013|raw* := FlickrWrapper::getalbumContent(descr.album)|<p>*",fillcolor="#FFFFCC",style=filled];
  a04 [label="a04|shuffled* := shuffle(raw*)|<p>*",fillcolor="#FFFFCC",style=filled];
  a05 [label="a05|trunacted* := truncate(shuffled*,maxSize)|<p>*",fillcolor="#FFFFCC",style=filled];
  a6  [label="a6|result.photo* := truncated*|<p>*",fillcolor="#FFFFCC",style=filled];
  a7 [label="a6|reply(result*)"];

  a1 -> a2;
  a2 -> a13;
  a13 -> a14;
  a14 -> a6;
  a6 -> a7;
  a2 -> t;
  t -> a003 [label="c"];
  t -> a013 [label="!c"];
  a003 -> a013 [style="invis"]; //cosmetic
  a003 -> a04;
  a013 -> a04;
  a04 -> a05;
  a05 -> a6;

 subgraph cluster_policy {
    label="Set Policy";
    labeloc=b;
    rankdir=LR;
    node [fillcolor="#FFFFCC",style=filled];
    feed [label="-|descr := pop(descr*)"];
    acts [shape="doublecircle",label="*"];
    swell [label="-|result* := push(result,result*)"];
    feed -> acts -> swell;
  }

}