<?xml version="1.0" encoding="UTF-8"?>
<process
    name="FeedReader"
    targetNamespace="http://modalis.polytech.unice.fr/jSeduite/bpel/FeedReader"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:tns="http://enterprise.netbeans.org/bpel/FeedReader/FeedReader" xmlns:ns0="http://modalis.i3s.unice.fr/jSeduite/schema/FeedReader" xmlns:ns1="http://feeds.technical.jSeduite.modalis.i3s.unice.fr/">
    <import namespace="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" location="FeedReader.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/FeedRegistryServiceWrapper" location="localhost_8080/jSeduite/FeedRegistry/FeedRegistryServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://registry.technical.jSeduite.modalis.i3s.unice.fr/" location="localhost_8080/jSeduite/FeedRegistry/FeedRegistryService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/RssReaderServiceWrapper" location="localhost_8080/jSeduite/RssReader/RssReaderServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://feeds.technical.jSeduite.modalis.i3s.unice.fr/" location="localhost_8080/jSeduite/RssReader/RssReaderService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="registry" xmlns:tns="http://enterprise.netbeans.org/bpel/FeedRegistryServiceWrapper" partnerLinkType="tns:FeedRegistryLinkType" partnerRole="registry"/>
        <partnerLink name="reader" xmlns:tns="http://enterprise.netbeans.org/bpel/RssReaderServiceWrapper" partnerLinkType="tns:RssReaderLinkType" partnerRole="reader"/>
        <partnerLink name="external" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" partnerLinkType="tns:FeedReader" myRole="FeedReaderPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="ReadOut" xmlns:tns="http://feeds.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:readResponse"/>
        <variable name="ReadIn" xmlns:tns="http://feeds.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:read"/>
        <variable name="url" type="xsd:anyURI"/>
        <variable name="GetURLOut" xmlns:tns="http://registry.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:getURLResponse"/>
        <variable name="GetURLIn" xmlns:tns="http://registry.technical.jSeduite.modalis.i3s.unice.fr/" messageType="tns:getURL"/>
        <variable name="name" type="xsd:string"/>
        <variable name="FeedReaderOperationOut" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" messageType="tns:FeedReaderOperationResponse"/>
        <variable name="FeedReaderOperationIn" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" messageType="tns:FeedReaderOperationRequest"/>
    </variables>
    <sequence>
        <sequence name="a1">
            <receive name="a1_tech" createInstance="yes" partnerLink="external" operation="FeedReaderOperation" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" portType="tns:FeedReaderPortType" variable="FeedReaderOperationIn"/>
            <assign name="a1_post">
                <copy>
                    <from>$FeedReaderOperationIn.in/ns0:name</from>
                    <to variable="name"/>
                </copy>
            </assign>
        </sequence>
        <sequence name="a2">
            <assign name="a2_pre">
                <copy>
                    <from variable="name"/>
                    <to>$GetURLIn.parameters/name</to>
                </copy>
            </assign>
            <invoke name="a2_tech" partnerLink="registry" operation="getURL" xmlns:tns="http://registry.technical.jSeduite.modalis.i3s.unice.fr/" portType="tns:FeedRegistry" inputVariable="GetURLIn" outputVariable="GetURLOut"/>
            <assign name="a2_post">
                <copy>
                    <from>$GetURLOut.parameters/return</from>
                    <to variable="url"/>
                </copy>
            </assign>
        </sequence>
        <sequence name="a3">
            <assign name="a3_pre">
                <copy>
                    <from variable="url"/>
                    <to>$ReadIn.parameters/url</to>
                </copy>
            </assign>
            <invoke name="a3_tech" partnerLink="reader" operation="read" xmlns:tns="http://feeds.technical.jSeduite.modalis.i3s.unice.fr/" portType="tns:RssReader" inputVariable="ReadIn" outputVariable="ReadOut"/>
            <assign name="a3_post">
                <copy>
                    <from>$ReadOut.parameters/return</from>
                    <to>$FeedReaderOperationOut.out/ns0:return</to>
                </copy>
            </assign>
        </sequence>
        <sequence name="a4">
            <reply name="a4_tech" partnerLink="external" operation="FeedReaderOperation" xmlns:tns="http://modalis.polytech.unice.fr/jSeduite/wsdl/FeedReader" portType="tns:FeedReaderPortType" variable="FeedReaderOperationOut"/>
        </sequence>
    </sequence>
</process>
